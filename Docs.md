## Architecture
### Loading a game
 SGE dynamically loads one selected game (in code named mod) from the "mods" folder.
 Mods must met some requirements, eg. contains all the config files. (See *TODO*)
 Once the mod is loaded, SGE loads scene gived in mod/manifest.json in "start_scene" field. 
### Entities, components and assets
 In SGE, game objects are called **entities**. Entities are composites made of **components**.
 Components allows entity to interact with engine subsystems like the renderer or audio system.
 They can be also added and removed from the entities at runtime. 

 Often components needs additional data to work, eg. sprite needs an image.
 This data is stored inside **assets**. Assets are automatically loaded when needed, and unloaded when not.

## Components in detail
 Each components has its own unique name (a 32 bit usingned integer), that differentiate it from other components inside the entity.
 Engine lua api allows passing strings as the components names - passed strings will be auto hashed into integers.

 There are 10 types of components:
 
 -*behavior* : links *behavior asset* to the entity therefore adding logic to the owner  
 -*camera* : allows renderer to render game objects to the screen  
 -*collider* : adds collision to the entity  
 -*dynamics* : handles forces, gravitation etc.  
 -*static mesh* : remders given *mesh asset* with given *shader asset* and given set of *texture assets*  
 -*sprite* : renders sprite + adds collision  
 -*flipbook* : renders flipbook (animations made of sprites) + adds collision  
 -*tilemap* : renders *tilemap asset* using textures from *tileset asset* + adds collision   
 -*sound emitter* : emitts *sound asset* in owner's position  
 -*listener* : represents sound listener in world space  

 ## Assets in detail
  Each asset is represented by .json file, consisting of "asset_type" field, with string determining asset type, and additional asset-type-dependant data.  
  Example sprite_sheet asset:  
  ```  
  {
      "asset_type" : "sprite_sheet",
      "path" : "$/player_sprite_sheet.png",
  
      "sprite_width" : 16,
      "sprite_height" : 16
  }
```
  There are 14 types of assets:  
  
-*behavior* : represents lua script. (See *TODO*) Example:  
 ```
{
    "asset_type" : "behavior",
    "path" : "$/controller.lua"
}
```
-*texture* : represents texture. (See *TODO*) Example:
```
{
    "asset_type" : "texture",
    "path" : "$/apple_texture.png",
}
```
-*sprite_sheet* : represents sprite sheet. (See *TODO*) Example:
```
{
    "asset_type" : "flipbook",
    "path" : "$/player_sprite_sheet.png",

    "sprite_width" : 16,
    "sprite_height" : 16
}
```
-*flipbook* : represents sprite sheet, and provide information about animations. (See *TODO*) Example:
```
{
    "asset_type" : "flipbook",
    "path" : "$/player_sprite_sheet.png",

    "sprite_width" : 16,
    "sprite_height" : 16,

    "animations" : {
        "idle" : {
            "fps" : 4,
            "frames" : [0, 1, 2, 3, 4, 5]
        }
    }
}
```
-*shader* : represents GLSL shader. (See *TODO*) Example:
```
{
    "asset_type" : "shader",
    "path" : "$/sprite_shader.glsl"
}
```
-*tileset* : represents tileset and provide infromation about which tiles (Numbering from top-left corner, starting at 1) should have collision. (See *TODO*) Example:
```
{
    "asset_type" : "tileset",
    "path" : "$/tileset.png",

    "tile_width" : 8,
    "tile_height" : 8,

    "collisions" : [
        1,  2,  3,  4,
        17, 19, 20,
        33, 34, 35, 36,
        49, 50, 51, 52,
    ]
}
```
-*tilemap* : represents tilemap generated by tiled program. (See *TODO*) Example:
```
{
    "asset_type" : "tilemap",
    "path" : "$/tilemap.tmj"
}
```
-*scene* : represents lua script that create, and manage an scene. (See *TODO*) Example:
```
{
    "asset_type" : "scene",
    "path" : "$/scene.lua"
}
```
-*sound* : represents mp3 sound. (See *TODO*) Example:
```
{
    "asset_type" : "sound",
    "path" : "$/orchestra.mp3"
}
```
-*mesh* : represents an mesh (geometry). (See *TODO*) Example: 
```
{
    "asset_type" : "mesh",
    "path" : "$/square_mesh.mesh"
}
```
-*rendering_config* : contains renderer configuration. (See *TODO*) Example:
```
{
    "asset_type" : "rendering_config",
    "default_sprite_shader_override" : "core/sprite_shader",
    "use_pixel_aligned_camera" : true,
    "background_color" : [
        0.09411764705, 
        0.07843137254, 
        0.14509803921
    ]
}
```
-*input_config* : contains input subsystem configuraion. (See *TODO*) Example:
```
{
    "asset_type" : "input_config",

    "action_mappings" : {
        "jump" : ["Space"],
        "attack" : ["Enter"]
    },

    "axis_mappings" : {
        "move_forward" : {
            "W" : 1,
            "S" : -1
        },
        "move_right" : {
            "D" : 1,
            "A" : -1
        }
    }
}
``` 
-*collision_config* : contains collision presets configuration (See *TODO*) Example:
  ```
{
    "asset_type" : "collision_config",
  
    "body_types" : {
        "wall" : 0,
        "player" : 1,
        "enemy" : 2
    },
  
    "collision_presets" : {
        "player" : {
            "body_type" : "player",
            "responses" : {
               "player" : "ignore",
               "enemy" : "overlap",
               "wall" : "collide"
            }
        }
    }
}
```
-*custom_data* : contains custom set of informations. The information can be accessed from lua via _en_load_custom_data function. Example:
```
{
    "asset_type" : "custom_data",

    "abc" : "foo",
    "b" : 64,
    "pi" : 3.14,
    "is_valid" : true,

    "an_object" : {
        "title" : "bar",
        "value" : 2024,
        "nested_data" : {
            "x" : 12
        }
    },
    "an_array" : [1, 2, 3],
    "array_of_objects" : [
        {
            "x" : 12
        },
        {
            "x" : 12
        }
    ]
}
```
# Engine API
SGE exposes api, through which lua scripts can manipulate the engine.  
All api functions uses following naming convention:   
``'\_' + letter indication of manipulated submodule / indication of the function + '\_' + rest of the name``
For example: ``_a_set_volume``, means ``audio\_subsystem::set\_volume``

## Entities Functions
Entities functions uses _e prefix.  

``entity_ref _e_create()``             : creates entity inside current scene (See *TODO*) and returns reference to it.    
``nil _e_kill(entity_ref e)``   : kills entity *e*    
``nil _e_is_alive(entity_ref e)`` : checks if entity *e* is still alive (has not been killed)  
``table _e_call(entity_ref e, string event_name, table args)`` : calls event of given name on all behaviors components inside the entity. Returns table of event calls return values. (See *TODO*)  
``nil _e_teleport(entity_ref e, number x, number y)`` : moves entity *e* to the postion *(x, y)* without checking the collision.  
``bool _e_sweep(entity_ref e, number x, number y)`` : moves entity *e* to the position *(x, y)* while checking the collision. Returns true, if entity has collided with other entity.  
``number, number _e_get_location(entity_ref e)`` : returns (x, y) position of the *e* entity  
``nil _e_kill_component(entity_ref e, integer/string name)`` : removes compononent of the given name from the entity.  
``integer _e_get_layer(entity_ref e)`` : returns layer on which the entity is located  
``nil _e_set_layer(entity_ref e, integer new_layer)`` : sets layer on which the entity is located

## Add Component Function
Add component functions used _e_add prefix.  

``nil _e_add_behavior(entity_ref e, integer/string name, string behavior_asset)`` : adds behavior component to the entity.  
``nil _e_add_camera(entity_ref e, integer/string name, number ortho_width)`` : adds camera component with given ortho width.  
``nil _e_add_static_mesh(entity_ref e, integer/string name, rendering_config rc)`` : adds static_mesh component to the entity.  
``nil _e_add_collider(entity_ref e, integer/string name, number extend_x, number extend_y)`` : adds collider component with given extend to the entity.  
``nil _e_add_sprite(entity_ref e, integer/string name, string sprite_sheet_asset, integer sprite_id, string collision_preset_name)`` : adds sprite component to the entity.  
``nil _e_add_flipbook(entity_ref e, integer/string name, string sprite_sheet_asset, string flipbook_animation, string collision_preset_name)`` : adds flipbook component to the entity.  
``nil _e_add_tilemap(entity_ref e, integer/string name, string tilemap_asset, string tileset_asset, string collision_preset_name)`` : adds tilemap component to the entity.  
``nil _e_add_dynamics(entity_ref e, integer/string name)`` : adds dynamics component to the entity.   
``nil _e_add_listener(entity_ref e, integer/string name)`` : adds listener component to the entity.  
``nil _e_add_sound_emitter(entity_ref e, integer/string name)`` : adds sound emmiter component to the entity.  

## Components Functions
Components functions uses _c\_ +  max. 2 letters indicating targetet component type prefix.  
Many functions are just obvious getters and setters so they descriptions are omitted.  
Also, because each of the functions takes as the first two arguments ``entity_ref e, integer/string component_name`` to shorten and simplify the docs those args are represented by \[Comp] in functions decriptions.  

any mesh functions (static_mesh, sprite, flipbook, tilemap) functions (_c_m):  
``bool _c_m_get_visible([Comp])``  
``nil _c_m_set_visible([Comp], bool visible)``  
``number, number _c_m_get_scale([Comp])``  
``nil _c_m_set_scale([Comp], number scale_x, number scale_y)``  
``number, number _c_m_get_offset([Comp])``  
``nil _c_m_set_offset([Comp], number offset_x, number offset_y)``  

static_mesh functions (_c_sm):   
``rendering_config _c_sm_get_render_config([Comp])``  
``nil _c_sm_set_render_config([Comp], rendering_config rc)``  

sprite functions (_c_s):  
``integer _c_s_get_sprite([Comp])``  
``nil _c_s_set_sprite([Comp], integer new_sprite)``  
``nil _c_s_set_shader([Comp], string new_shader)``  













